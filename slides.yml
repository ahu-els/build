default: [clean, slides, publish]

extends:
- c4s4/build/buildir.yml
- c4s4/build/release.yml

properties:
  NAME:        '#{filename(_BASE)}'
  TITLE:       ~
  OPTIONS:     '{ratio: "4:3"}'
  DESTINATION: '/home/web/slides/#{NAME}'

targets:

  slides:
    doc: 'Generate slides'
    steps:
    - mkdir: '#{BUILD_DIR}'
    - copy:   'res/template.html'
      tofile: '#{BUILD_DIR}/index.html'
    - read: 'README.md'
      to:   'content'
    - replace: '#{BUILD_DIR}/index.html'
      with:
        '<? OPTIONS ?>': '#{OPTIONS}'
        '<? TITLE ?>':   '#{TITLE}'
        '<? CONTENT ?>': '#{content}'
    - copy:  ['res/**/*', 'img/**/*']
      todir: '#{BUILD_DIR}'
      flat:  false

  publish:
    doc: 'Publish slides'
    steps:
    - $: ['rsync', '-av', '#{BUILD_DIR}/', '#{DESTINATION}/']
