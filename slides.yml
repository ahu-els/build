default: [clean, slides, publish]

extends: c4s4/build/buildir.yml

properties:
  TITLE:       ~
  OPTIONS:     '{ratio: "4:3"}'
  DESTINATION: '/home/web/slides/db-migration'

targets:

  slides:
    doc: 'Generate slides'
    steps:
    - mkdir: '#{BUILD_DIR}'
    - copy:   'res/template.html'
      tofile: '#{BUILD_DIR}/index.html'
    - replace: '#{BUILD_DIR}/index.html'
      pattern: '<? OPTIONS ?>'
      with:    '#{OPTIONS}'
    - replace: '#{BUILD_DIR}/index.html'
      pattern: '<? TITLE ?>'
      with:    '#{TITLE}'
    - read: 'README.md'
      to:   'content'
    - replace: '#{BUILD_DIR}/index.html'
      pattern: '<? CONTENT ?>'
      with:    '#{content}'
    - copy:  ['res/**/*', 'img/**/*']
      todir: '#{BUILD_DIR}'
      flat:  false

  publish:
    doc: 'Publish slides'
    steps:
    - 'rsync -av "#{BUILD_DIR}/" "#{DESTINATION}/"'
